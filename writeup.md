---
title: "Autorisation bypass - TODO"
date: 2023-04-24T14:33:43Z
draft: false
toc: false
images:
tags:
  - autorisation
  - bypass
---
<!-- These are required fields for the disclosure process -->
**Affected Product:** Evasys 

**Affected Versions:**  evasys v8.2 Build 2275 - 2285 and evasys v9.0 Build 2400 (both according to vendor)
 

**Fixed Version:** v8.2 Build 2286 and v9.0 Build 2401 

**CVE-Number:** TODO 

**Severity:** 8,1 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N)
<!-- Add your names. -->
*Discovered by Dipl-Ing. Mario Rubak, BSc MSc and Regina Kohl, BSc*

<!-- Brief introduction. -->
Several places were found where the implemented authorization scheme can be bypassed.


## Proof of Concept
<!-- In Depth discussion of the vulnerability. Whats it's impact, show enough proof but not too much. DO NOT INCLUDE EXPLOIT PAYLOADS! -->
**Read access (with valid token):**
The following URLs can be accessed via the dashboard of a user with the role of "Teilbereichsadmin". If these URLs are entered in the trainer's session, in conjunction with the trainer's current valid token in the browser, the trainer can call functions that are not available to them in the GUI.

```
Liste aller Teilbereiche
https://example.com/evasys/public/default/subunit/index?sNewMenuitemID=Headmenu_Subunits&TOKEN=<valid-trainer-token>

Umfragen anzeigen (including display of users)
https://example.com/evasys/public/default/surveylist/index?mode=show_zentview&subunits=1&refresh_session=1&instructors=35&periods=-1&TOKEN=<valid-trainer-token>

Performanzübersicht (including display of current user)
https://example.com/evasys/public/default/performance/index?sNewMenuitemID=Systemperformance&TOKEN=<valid-trainer-token>

Dokumente und Vorlagen (including download of documents)
https://example.com/evasys/public/legacy/document.php?documentid=5&TOKEN=<valid-trainer-token> 

Export von anderen Fragebögen (.vfd files)
https://example.com/evasys/public/legacy/form_script.php?build=/&export=/&frmid=2139&TOKEN=<valid-trainer-token>

Umfragen anzeigen (including display of multiple data such as users, ...)
https://example.com/evasys/public/default/surveylist/index?TOKEN=<valid-trainer-token>
```

It is noticeable that the "trainer" role sometimes sees more data than the "Teilbereichsadmin" role, as can be seen in the following figure.
!["Trainer" role sees more entries than "Teilbereichsadmin" role](../images/auto_1)

**Read access (without token):**
Furthermore, a trainer can view other questionnaires by enumerating the frmid:
``https://example.com/evasys/public/online/index/preview?frmid=2139&nOnlineTemplateId=0``
**Write access:**
As already described, users can partially access URLs that are not available in the GUI, provided they use their currently valid token in the TOKEN parameter.
The following example describes a case where not only read access, but also write access is granted. In this case, the template name of an online template of another user is modified.
The following URL cannot be accessed through the sub-admin dashboard. However, if the sub-admin enters the following URL with their current token in the browser, they can access the online template management.

```
https://example.com/evasys/public/default/onlinetemplatelist/index?sNewMenuitemID=OnlineTemplates&TOKEN=<valid-"Teilbereichsadmin"-Token>
```

As seen in the following figure, the user is only shown their own online templates and those of the SYSTEM. A user with the "Teilbereichsadmin" role can now create online templates (Online Template ID 7 was created by the researchers) or edit other users' online templates.
If the user tries to edit their own template (pencil icon) and enters the existing online template ID of another user in the corresponding request, they can change the names of other users' online templates, even though they are not displayed in the application interface.

![Accessing "Onlinetemplate-Verwaltung" with the role "Teilbereichsadmin" ](../images/auto_2)

![User with role "Teilbereichsadmin" changes online template of a user with the role "Trainer" ](../images/auto_3)
![Modified online template - comparison view of users](../images/auto_4)

Another way to make unauthorized changes is by editing other users. In this case, a valid request (edit of a user who allows editing) must be used, intercepted with an HTTP proxy, and the parameter userid must be changed to a valid value. This allowed the auditors to access the "Edit user attributes" interface of a user who cannot be directly edited in the GUI. However, the auditors did not attempt to make and save any changes.
![No user editing possible in GUI](../images/auto_5)
![Calling up "Nutzerattribute ändern" by manipulating the userid](../images/auto_5)



## Vendor contact timeline 
<!-- Fill in your contact timeline!-->
| Date       | Action                                                                                                                                                                             |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2022/07/26    | Discovery of the vulnerability    |
| 2023/08/05    | Bulk disclosure of multiple vulnerabilities using the vendors support mail    |
| 2023/08/08    | Vendors respond that they acknowledge the findings and start to work on a fix    |
| 2023/08/10    | Evasys shares detailed plan for the fix with the researchers and asks for a few months of time before disclosing the vulnerability    |
| 2023/08/23    | Vendor responds that the vulnerabilities will be fixed in version 8.2 and 9.0 in 2023/09/06  |
| 2023/01/02    | First attempt to request CVEs at MITRE  |
| 2023/03/23    | Request was closed by MITRE without stating a reason  |
| 2023/04/24    | Second attempt to request CVEs at MITRE   |
| 2023/03/02    | MITRE assigns  TODO |
| 2023/TODO/TODO    | TODO  |
| 2023/TODO/TODO    | TODO  |
| 2023/TODO/TODO    | TODO  |

